<p align="center">
    <img src="https://avatars.githubusercontent.com/u/82603435?v=4" width="140px" alt="Helm LOGO"/>
</p>

<div align="center">

  [![Blog](https://img.shields.io/badge/Blog-blue?style=for-the-badge&logo=buymeacoffee&logoColor=white)](https://une-tasse-de.cafe/)
  [![Pulumi](https://img.shields.io/badge/Pulumi-8A3391?style=for-the-badge&logo=pulumi&logoColor=white)](https://www.pulumi.com/)
  [![Openstack](https://img.shields.io/badge/Openstack-%23f01742.svg?style=for-the-badge&logo=openstack&logoColor=white)](https://www.openstack.org/)

</div>

## Pulumi Falco Openstack Example

This example demonstrates how to deploy nodes to try Falco on an Openstack host using Pulumi.

Note: By default, the values in the `Pulumi.yaml` use Infomaniak Openstack. You can change the values in the `Pulumi.yaml` file to match your Openstack configuration.

### Prerequisites

1. [Install Pulumi](https://www.pulumi.com/docs/get-started/install/)
2. [Install Python3](https://www.python.org/downloads/)
3. Create a virtual environment:
```bash
python3 -m venv venv
```
4. Install the required Python packages:
```bash
python3 -m pip install -r requirements.txt
```

### Running the Example

Login to your openstack account (horizon) and source the openstack rc file:
```bash
source openstack.rc
```

Create a new project using this template:
```bash
pulumi new https://github.com/CuistOps/falco/tree/main
```

Run the pulumi program:
```bash
pulumi up
```

### Connect to hosts

You can connect to the nodes using the private key generated by the Pulumi program. Unlike the public key in the `Pulumi.yaml` file, the private key is only used to let the admin node connect to the other nodes.

Export the private key that can be used to connect to the nodes:

```bash
pulumi stack output nodes_keypair --show-secrets > nodes_keypair.pem
```

Send it to the admin node:

```bash
scp nodes_keypair.pem debian@$(pulumi stack output admin_external_ip):.ssh/id_rsa
ssh debian@$(pulumi stack output admin_external_ip) chmod 600 .ssh/id_rsa
```

*:warning: Note that you have to set the pulumi config passphrase to access content of the private key.*

### Destroy the resources

To destroy the resources created by the Pulumi program, run the following command:

```bash
pulumi destroy
```
